<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDR Health Tracker</title>
    <style>
        /* Main Blue Background */
        body { font-family: 'Poppins', sans-serif; background: #2980b9; margin: 0; padding: 15px; text-align: center; color: white; }
        
        .container { 
            max-width: 450px; margin: auto; background: white; padding: 25px; 
            border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); color: #333;
        }

        h1 { color: #2980b9; margin-bottom: 5px; font-size: 24px; }
        .date-display { color: #e74c3c; font-weight: bold; margin-bottom: 20px; }

        /* Tablet Cards */
        .pill-card { 
            background: #f8f9fa; border-radius: 15px; padding: 15px; 
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
        }
        .pill-info { text-align: left; }
        .pill-time { font-weight: 800; color: #2980b9; display: block; font-size: 0.85rem; }
        
        .check-btn { 
            width: 55px; height: 55px; border-radius: 50%; border: none; 
            background: #dfe6e9; cursor: pointer; font-size: 22px; color: white;
        }
        .taken { background: #27ae60 !important; }
        .missed { background: #e74c3c !important; }
        .waiting { background: #f1c40f !important; }

        /* Report Button */
        .download-btn {
            background: #2ecc71; color: white; border: none; padding: 12px 25px;
            border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; width: 100%;
        }

        /* Hidden Report Template (Visible only when generating) */
        #report-section { display: none; }

        @media print {
            body * { visibility: hidden; }
            #report-section, #report-section * { visibility: visible; }
            #report-section { 
                position: absolute; left: 0; top: 0; width: 100%; height: 100%; 
                background: white; color: black; padding: 40px; text-align: left;
                background-image: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), url('kdr.jpg');
                background-size: 60%; background-repeat: no-repeat; background-position: center;
            }
            /* If no kdr.jpg, this blue text watermark acts as backup */
            #report-section::before {
                content: "KDR"; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg);
                font-size: 150px; color: rgba(41, 128, 185, 0.1); font-weight: bold; z-index: -1;
            }
            .download-btn { display: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>KDR Tablet Tracker</h1>
    <div id="currentDate" class="date-display"></div>

    <div id="tracker-list">
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">7:00 AM</span><span>1 Sugar Tablet</span></div>
            <button class="check-btn" id="btn-1" onclick="markTaken(1)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">9:00 AM</span><span>1 Sugar + 1 BP</span></div>
            <button class="check-btn" id="btn-2" onclick="markTaken(2)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">12:30 PM</span><span>2 Cancer Tablets</span></div>
            <button class="check-btn" id="btn-3" onclick="markTaken(3)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">6:00 PM</span><span>1 Sugar Tablet</span></div>
            <button class="check-btn" id="btn-4" onclick="markTaken(4)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">8:30 PM</span><span>2 Cancer Tablets</span></div>
            <button class="check-btn" id="btn-5" onclick="markTaken(5)"></button>
        </div>
    </div>

    <button class="download-btn" onclick="generateReport()">Download 2-Month Report</button>
</div>

<div id="report-section">
    <h1 style="color: #2980b9;">Health Record: Last 2 Months</h1>
    <hr>
    <div id="history-content"></div>
</div>

<script>
    const schedule = [
        { id: 1, h: 7, m: 0 }, { id: 2, h: 9, m: 0 }, { id: 3, h: 12, m: 30 },
        { id: 4, h: 18, m: 0 }, { id: 5, h: 20, m: 30 }
    ];

    function refreshTracker() {
        const now = new Date();
        const dateKey = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
        document.getElementById('currentDate').innerText = now.toDateString();

        schedule.forEach(item => {
            const btn = document.getElementById(`btn-${item.id}`);
            const start = new Date(); start.setHours(item.h, item.m, 0);
            const end = new Date(start); end.setHours(start.getHours() + 1);
            const status = localStorage.getItem(`pill_${item.id}_${dateKey}`);

            if (status === 'done') {
                btn.className = 'check-btn taken'; btn.innerHTML = '✔'; btn.disabled = true;
            } else if (now > end) {
                btn.className = 'check-btn missed'; btn.innerHTML = '✘'; btn.disabled = true;
            } else if (now >= start && now <= end) {
                btn.className = 'check-btn'; btn.innerHTML = 'TAP'; btn.disabled = false;
            } else {
                btn.className = 'check-btn waiting'; btn.innerHTML = '⏳'; btn.disabled = true;
            }
        });
    }

    function markTaken(id) {
        const dateKey = new Date().getFullYear() + "-" + (new Date().getMonth() + 1) + "-" + new Date().getDate();
        localStorage.setItem(`pill_${id}_${dateKey}`, 'done');
        refreshTracker();
    }

    function generateReport() {
        const historyContent = document.getElementById('history-content');
        historyContent.innerHTML = '';
        const now = new Date();

        for (let i = 0; i < 2; i++) {
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const monthName = date.toLocaleString('default', { month: 'long', year: 'numeric' });
            let completed = 0, total = 0;
            const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();

            for (let d = 1; d <= daysInMonth; d++) {
                const checkDate = new Date(date.getFullYear(), date.getMonth(), d);
                if (checkDate <= now) {
                    const keyPart = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + d;
                    schedule.forEach(p => {
                        total++;
                        if (localStorage.getItem(`pill_${p.id}_${keyPart}`) === 'done') completed++;
                    });
                }
            }
            historyContent.innerHTML += `<h3>${monthName}</h3><p>Success Rate: ${completed}/${total} doses taken.</p><br>`;
        }
        window.print();
    }

    setInterval(refreshTracker, 30000);
    window.onload = refreshTracker;
</script>

</body>
</html>
