<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDR Health Tracker</title>
    <style>
        /* Primary Blue Background */
        body { 
            font-family: 'Poppins', sans-serif; 
            background: #2980b9; 
            margin: 0; 
            padding: 15px; 
            text-align: center; 
            color: white; 
        }
        
        /* Container with a faint Blue-shaded KDR background */
        .container { 
            max-width: 450px; 
            margin: auto; 
            background: rgba(255, 255, 255, 0.98); 
            padding: 25px; 
            border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            color: #333;
            position: relative;
            overflow: hidden;
        }

        /* Large KDR Watermark behind cards */
        .container::before {
            content: "KDR";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 120px;
            color: rgba(41, 128, 185, 0.05); /* Faint blue shade */
            font-weight: bold;
            z-index: 0;
            pointer-events: none;
        }

        h1 { color: #2980b9; margin-bottom: 5px; font-size: 26px; z-index: 1; position: relative; }
        .date-display { color: #e74c3c; font-weight: bold; margin-bottom: 20px; z-index: 1; position: relative; }

        .pill-card { 
            background: #fff; 
            border: 1px solid #d1d8e0;
            border-radius: 18px; 
            padding: 15px; 
            margin-bottom: 12px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            z-index: 1;
            position: relative;
        }

        .pill-info { text-align: left; }
        .pill-time { font-weight: 800; color: #2980b9; display: block; font-size: 0.9rem; }
        .pill-name { font-size: 1rem; color: #2d3436; font-weight: 600; }

        .check-btn { 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            border: none; 
            background: #dfe6e9; 
            cursor: pointer; 
            font-size: 24px; 
            color: white;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Logic Styles */
        .taken { background: #27ae60 !important; }
        .missed { background: #e74c3c !important; }
        .waiting { background: #f1c40f !important; }

        .download-btn {
            background: #27ae60; 
            color: white; 
            border: none; 
            padding: 14px; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 20px; 
            width: 100%;
            font-size: 1rem;
        }

        /* Report View (Print) */
        @media print {
            body { background: white !important; padding: 0; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; }
            .container::before { color: rgba(41, 128, 185, 0.1); font-size: 200px; }
            .download-btn, .check-btn { display: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>KDR Tablet Tracker</h1>
    <div id="currentDate" class="date-display"></div>

    <div id="tracker-list">
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">7:00 AM - 8:00 AM</span><span class="pill-name">1 Sugar Tablet</span></div>
            <button class="check-btn" id="btn-1" onclick="markTaken(1)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">9:00 AM - 10:00 AM</span><span class="pill-name">1 Sugar + 1 BP</span></div>
            <button class="check-btn" id="btn-2" onclick="markTaken(2)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">12:30 PM - 1:30 PM</span><span class="pill-name">2 Cancer Tablets</span></div>
            <button class="check-btn" id="btn-3" onclick="markTaken(3)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">6:00 PM - 7:00 PM</span><span class="pill-name">1 Sugar Tablet</span></div>
            <button class="check-btn" id="btn-4" onclick="markTaken(4)"></button>
        </div>
        <div class="pill-card">
            <div class="pill-info"><span class="pill-time">8:30 PM - 9:30 PM</span><span class="pill-name">2 Cancer Tablets</span></div>
            <button class="check-btn" id="btn-5" onclick="markTaken(5)"></button>
        </div>
    </div>

    <button class="download-btn" onclick="window.print()">Download KDR Report</button>

    <div style="margin-top: 20px; font-size: 0.8rem; color: #7f8c8d;">
        Last 2 Months History included in Report
    </div>
</div>

<script>
    const schedule = [
        { id: 1, h: 7, m: 0 }, { id: 2, h: 9, m: 0 }, { id: 3, h: 12, m: 30 },
        { id: 4, h: 18, m: 0 }, { id: 5, h: 20, m: 30 }
    ];

    function updateTracker() {
        const now = new Date();
        const dateKey = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
        document.getElementById('currentDate').innerText = now.toDateString();

        schedule.forEach(item => {
            const btn = document.getElementById(`btn-${item.id}`);
            const start = new Date(); start.setHours(item.h, item.m, 0);
            const end = new Date(start); end.setHours(start.getHours() + 1);
            
            const status = localStorage.getItem(`pill_${item.id}_${dateKey}`);

            if (status === 'done') {
                btn.className = 'check-btn taken'; btn.innerHTML = '✔';
            } else if (now > end) {
                // MISSING CASE: Marked with KDR style as requested
                btn.className = 'check-btn missed'; btn.innerHTML = 'KDR'; 
                btn.style.fontSize = '14px'; // Make KDR fit in circle
            } else if (now >= start && now <= end) {
                btn.className = 'check-btn'; btn.innerHTML = 'TAP';
            } else {
                btn.className = 'check-btn waiting'; btn.innerHTML = '⏳';
            }
        });
    }

    function markTaken(id) {
        const dateKey = new Date().getFullYear() + "-" + (new Date().getMonth() + 1) + "-" + new Date().getDate();
        localStorage.setItem(`pill_${id}_${dateKey}`, 'done');
        updateTracker();
    }

    setInterval(updateTracker, 1000);
    window.onload = updateTracker;
</script>

</body>
</html>
